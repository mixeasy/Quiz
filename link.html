<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Redirect...</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial;
  background: #f6f7fb;
  text-align: center;
  padding-top: 60px;
}
.box {
  background: white;
  padding: 25px;
  max-width: 520px;
  margin: auto;
  border-radius: 12px;
  box-shadow: 0 10px 20px rgba(0,0,0,.08);
}
</style>
</head>

<body>
<div class="box">
  <h2 id="status">üîÑ ƒêang x·ª≠ l√Ω...</h2>
  <p id="msg"></p>
</div>

<script>
(() => {
  const JSON_URL = "https://huyquochoc.github.io/Quiz/shortlinks.json";

  const params = new URLSearchParams(window.location.search);
  const key = params.get("id");

  const statusEl = document.getElementById("status");
  const msgEl = document.getElementById("msg");

  if (!key) {
    statusEl.textContent = "‚ùå Link kh√¥ng h·ª£p l·ªá";
    msgEl.textContent =
      "Thi·∫øu m√£ truy c·∫≠p. Vui l√≤ng ki·ªÉm tra l·∫°i link ho·∫∑c ƒë·ª£i v√†i ch·ª•c gi√¢y n·∫øu v·ª´a m·ªõi t·∫°o.";
    return; // ‚úÖ H·ª¢P L·ªÜ v√¨ ƒëang trong function
  }

  const retryKey = "retry_" + key;
  let retry = Number(sessionStorage.getItem(retryKey) || 0);

  fetch(JSON_URL + "?t=" + Date.now())
    .then(r => r.json())
    .then(data => {
      if (!data[key]) {

        if (retry < 2) {
          retry++;
          sessionStorage.setItem(retryKey, retry);

          statusEl.textContent = "‚è≥ ƒêang ƒë·ªìng b·ªô link...";
          msgEl.textContent = "T·ª± ƒë·ªông th·ª≠ l·∫°i sau v√†i gi√¢y.";

          setTimeout(() => location.reload(), 5000);
        } else {
          statusEl.textContent = "‚ùå Link ch∆∞a s·∫µn s√†ng";
          msgEl.textContent =
            "Vui l√≤ng th·ª≠ l·∫°i sau 1‚Äì2 ph√∫t ho·∫∑c ki·ªÉm tra l·∫°i m√£ link.";
        }
        return;
      }

      sessionStorage.removeItem(retryKey);

      const record = data[key];
      const url = record.url;
      const expire = record.expire;

      if (!url) {
        statusEl.textContent = "‚ùå L·ªói d·ªØ li·ªáu";
        msgEl.textContent = "Kh√¥ng t√¨m th·∫•y URL";
        return;
      }

      if (expire) {
        const today = new Date().toISOString().split("T")[0];
        if (today > expire) {
          statusEl.textContent = "‚õî Link ƒë√£ h·∫øt h·∫°n";
          msgEl.textContent = "Vui l√≤ng li√™n h·ªá gi√°o vi√™n";
          return;
        }
      }

      statusEl.textContent = "‚úÖ";
      msgEl.textContent = "ƒêang chuy·ªÉn h∆∞·ªõng...";

      setTimeout(() => {
        window.location.replace(url);
      }, 700);
    })
    .catch(() => {
      statusEl.textContent = "‚ö†Ô∏è L·ªói t·∫£i d·ªØ li·ªáu";
      msgEl.textContent = "Kh√¥ng th·ªÉ t·∫£i shortlinks.json";
    });
})();
</script>



</body>
</html>
